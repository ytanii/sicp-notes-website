---
title: The Environment Model of Evaluation
pubDate: 2026-01-30
chapter: 3
section: 2
---
- Recall the substitution model:

> To apply a compound procedure to arguments, evaluate the body of the procedure with each formal parameter replaced by the corresponding argument. 

- This is no longer adequate once we allow assignment.
- Variables are no longer merely names for values; rather, a variable designates a "place" in which values can be stored.
- These places will be maintained in structures called *environments*.
- An environment is a sequence of *frames*. A frame is a table of *bindings*. A binding associates a variable name with one value.
- Each frame also has a pointer to its enclosing environment, unless it is considered to be global.
- The value of a variable with respect to an environment is the value given by the binding in the first frame of the environment that contains a binding for that variable.
- If no frame in the sequence specifies a binding for the variable, then the variable is *unbound* in the environment.
- A binding *shadows* another (of the same variable) if the other is in a frame that is further in the sequence.
- The environment determines the context in which an expression should be evaluated. An expression has no meaning otherwise.
- The global environment consists of a single frame, and it is implicitly used in interactions with the interpreter.

## The Rules for Evaluation
- To evaluate a combination:
    1. Evaluate the subexpressions of the combination.
    2. Apply the value of the operator subexpression to the value of the operand subexpressions.
- The environment model redefines the meaning of “apply.”
- A procedure is created by evaluating a λ-expression relative to a given environment.
- The resulting procedure object is a pair consisting of the text of the λ-expression and a pointer to the environment in which the procedure was created.
- To apply a procedure to arguments, create a new environment whose frame binds the parameters to the values of the arguments and whose enclosing environment is specified by the procedure.
- Then, within the new environment, evaluate the procedure body.
- `(lambda (x) (* x x))` evaluates a to pair: the parameters and the procedure body as one item, and a pointer to the global environment as the other.
- `(define square (lambda (x) (* x x)))` associates the symbol `square` with that procedure object in the global frame.
- Evaluating `(define __!!var!!__ __!!val!!__ )` creates a binding in the current environment frame to associate `  __!!var!!__  ` with `  __!!val!!__  `.
- Evaluating `(set! __!!var!!__ __!!val!!__ )` locates the binding of `  __!!var!!__  ` in the current environment (the first frame that has a binding for it) and changes the bound value to `  !!__val__!! `. 
