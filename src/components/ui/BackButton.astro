---
import { themeConfig } from '@/config'
---

<a href="/" class="back-button" aria-label="Back to home" title="Back to home">
  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M3 8H13M3 8L6.5 4.5M3 8L6.5 11.5"
      stroke="currentColor"
      stroke-width="1.4"
      stroke-linecap="round"
      stroke-linejoin="round"></path>
  </svg>
  <span class="back-label">index</span>
</a>

<script
  is:inline
  define:vars={{
    contentWidth: themeConfig.general.contentWidth,
    centeredLayout: themeConfig.general.centeredLayout,
    toc: themeConfig.post.toc
  }}
>
  ;(function () {
    // Adjust back button position based on layout and screen size
    function adjustBackButtonPosition() {
      const button = document.querySelector('.back-button')
      if (!button) return

      // If not using centered layout, remove fixed positioning
      if (!centeredLayout) {
        button.classList.remove('fixed-position')
        button.style.left = ''
        return
      }

      // Calculate available margin space for positioning
      const pageWidth = window.innerWidth
      const contentWidthValue = parseFloat(contentWidth)
      // Apply the same minimum width logic as in BaseLayout
      const widthValue = Math.min(contentWidthValue, 50)
      const shouldUseCustomWidth = widthValue > 25
      const finalWidthValue = shouldUseCustomWidth ? widthValue : 25
      const margin = (pageWidth - finalWidthValue * 16) / 2
      const baseMinSpace = 11 * 16 // Base minimum space needed
      // If toc is enabled, need additional 2.5rem (40px) space
      const minSpace = toc ? baseMinSpace + 52 : baseMinSpace + 12

      // Position button fixed on the left if there's enough space
      if (margin >= minSpace) {
        button.classList.add('fixed-position')
        const basePosition = margin - baseMinSpace
        // If toc is enabled, move 2.5rem (40px) further left
        const leftPosition = toc ? basePosition - 40 : basePosition
        button.style.left = `${leftPosition}px`
      } else {
        button.classList.remove('fixed-position')
        button.style.left = ''
      }
    }

    adjustBackButtonPosition()

    if (!document.documentElement.hasAttribute('data-back-button-bound')) {
      document.documentElement.setAttribute('data-back-button-bound', '1')
      // Use only astro:page-load as it fires on initial load and navigation
      document.addEventListener('astro:page-load', adjustBackButtonPosition)
      window.addEventListener('resize', adjustBackButtonPosition)
    }
  })()
</script>

<style>
  .back-button {
    width: fit-content;
    max-width: 8rem;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    font-family: var(--serif);
    font-size: var(--font-size-m);
    font-style: italic;
    letter-spacing: 0;
    line-height: 1.15;
    color: var(--text-secondary);
    cursor: pointer;
    border: none;
    background-color: transparent;
    position: relative;
    margin-bottom: 2.5em;
    padding: 0.1rem 0.35rem;
    left: -0.175em;
    border-radius: 999px;
    border: 1px solid transparent;
    transition:
      color var(--motion-fast) var(--motion-ease),
      background-color var(--motion-fast) var(--motion-ease),
      border-color var(--motion-fast) var(--motion-ease);
    text-decoration: none;
  }

  .back-button:hover {
    color: var(--text-primary);
    background: var(--surface);
    border-color: var(--border);
  }

  @media (hover: none) and (pointer: coarse) {
    .back-button:hover {
      color: var(--text-secondary);
    }
  }

  .back-button svg {
    width: 0.98rem;
    height: 0.98rem;
    flex-shrink: 0;
    transform: translateY(0.01em);
    transition: transform var(--motion-fast) var(--motion-ease);
  }

  .back-label {
    display: inline-block;
    line-height: 1;
    transform: translateY(0.01em);
  }

  .back-button:hover svg,
  .back-button:focus-visible svg {
    transform: translateX(-2px);
  }

  .back-button.fixed-position {
    position: fixed;
    top: 6rem;
    margin-bottom: 0;
    padding-left: 0.6rem;
    padding-right: 0.55rem;
    z-index: 10;
  }

  .back-button:focus-visible {
    color: var(--text-primary);
    border-color: var(--text-tertiary);
    background: var(--surface);
  }

  @media (max-width: 768px) {
    .back-button {
      margin-bottom: 2em;
    }
  }
</style>
